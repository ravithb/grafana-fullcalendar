{"version":3,"sources":["../src/calendar_ctrl.js"],"names":["packageId","panelDefaults","calendarId","calendarColor","color","bgColor","borderColor","columnMappings","idField","titleField","startField","endField","allDayField","dataField","categoryField","CalendarCtrl","$scope","$injector","contextSrv","_","defaults","panel","dataFormatter","DataFormatter","kbn","events","on","onInitEditMode","bind","onDataReceived","onPanelTeardown","onDataSnapshotLoad","$watch","throttle","render","calendar","destroy","addEditorTab","dataList","length","data","type","tableData","map","tableHandler","setTableValues","snapshotData","setCalendarColor","refresh","scope","elem","attrs","ctrl","MetricsPanelCtrl","templateUrl"],"mappings":"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","sourcesContent":["/*eslint id-length: [\"error\", { \"min\": 1 }]*/\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\nimport TimeSeries from 'app/core/time_series2';\nimport kbn from 'app/core/utils/kbn';\nimport calRenderer from './cal_renderer';\nimport DataFormatter from './data_formatter';\nimport './css/calendar.css!';\n\nconst packageId = 'ravithb-tui-calendar-panel';\n\nconst panelDefaults = {\n  calendarId: '1',\n  calendarColor: {\n    color: '#333333',\n    bgColor: '#1396FF',\n    borderColor: '#999999'\n  },\n  columnMappings: {\n    idField: 'id',\n    titleField: 'title',\n    startField: 'start',\n    endField: 'end',\n    allDayField: 'all_day',\n    dataField: 'url',\n    categoryField: 'category'\n  }\n}\n\nexport default class CalendarCtrl extends MetricsPanelCtrl {\n  calendar;\n  \n  constructor($scope, $injector, contextSrv) {\n    super($scope, $injector);\n\n    _.defaults(this.panel,panelDefaults);\n    this.dataFormatter = new DataFormatter(this, kbn);\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n    this.events.on('data-snapshot-load', this.onDataSnapshotLoad.bind(this));\n    \n    $scope.$watch(\n      'ctrl.panel.content',\n      _.throttle(() => {\n        this.render();\n      }, 1000)\n    );\n  }\n\n  onPanelTeardown() {\n    if(this.calendar){\n      this.calendar.destroy();\n    }\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Calendar', 'public/plugins/'+packageId+'/partials/editor.html', 2);\n  }\n\n  onDataReceived(dataList) {\n    if (!dataList || !dataList.length || dataList.length==0) return;\n\n    const data = [];\n\n    if (dataList[0].type === 'table') {\n      const tableData = dataList.map(DataFormatter.tableHandler.bind(this));\n      this.dataFormatter.setTableValues(tableData, data);\n    }\n\n    this.data = data;\n\n    this.render();\n   \n  }\n\n  onDataSnapshotLoad(snapshotData) {\n    this.onDataReceived(snapshotData);\n  }\n\n  setCalendarColors(){\n    if(!this.calendar){\n      return;\n    }\n    this.calendar.setCalendarColor(this.panel.calendarColor);\n    this.refresh();\n  }\n\n  /* eslint class-methods-use-this: 0 */\n  link(scope, elem, attrs, ctrl) {\n    calRenderer(scope, elem, attrs, ctrl);\n  }\n\n}\n\nCalendarCtrl.templateUrl = 'module.html'"],"file":"calendar_ctrl.js"}